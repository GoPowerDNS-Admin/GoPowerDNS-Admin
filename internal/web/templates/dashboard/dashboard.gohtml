<!--begin::App Wrapper-->
<div class="app-wrapper">
    {{ template "partials/header-navigation" .}}
    {{ template "partials/sidebar-navigation" .}}
    <!--begin::App Main-->
    <main class="app-main">
        <!--begin::App Content Header-->
        <div class="app-content-header">
            <!--begin::Container-->
            <div class="container-fluid">
                <!--begin::Row-->
                <div class="row">
                    <div class="col-sm-6"><h3 class="mb-0">{{.Navigation.PageTitle}}</h3></div>
                    <div class="col-sm-6">
                        <ol class="breadcrumb float-sm-end">
                            {{range .Navigation.Breadcrumbs}}
                                {{if .Active}}
                                    <li class="breadcrumb-item active" aria-current="page">{{.Title}}</li>
                                {{else}}
                                    <li class="breadcrumb-item"><a href="{{.URL}}">{{.Title}}</a></li>
                                {{end}}
                            {{end}}
                        </ol>
                    </div>
                </div>
                <!--end::Row-->
            </div>
            <!--end::Container-->
        </div>
        <!--end::App Content Header-->
        <!--begin::App Content-->
        <div class="app-content">
            <!--begin::Container-->
            <div class="container-fluid">
                <!--begin::Row-->
                <div class="row">
                    <div class="col-12">
                        <!-- begin::Card-->
                        <div class="card card-outline card-primary shadow mb-4">
                            <!-- begin::Card Header-->
                            <div class="card-header">
                                <h3 class="card-title">Zones</h3>
                                <div class="card-tools">
                                    <div class="nav-tabs-custom">
                                        <ul class="nav nav-tabs card-header-tabs" id="custom-content-below-tab"
                                            role="tablist">
                                            <li class="nav-item" role="presentation">
                                                <a class="nav-link {{if or (not .Data) (eq .Data.ActiveTab "forward")}}active{{end}}"
                                                   href="?tab=forward"
                                                   id="zones-tab"
                                                   role="tab"
                                                   aria-controls="zones-tab-pane"
                                                   aria-selected="{{if or (not .Data) (eq .Data.ActiveTab "forward")}}true{{else}}false{{end}}">
                                                    Forward Zones{{if .Data}} ({{.Data.ForwardTab.TotalItems}}){{end}}
                                                </a>
                                            </li>
                                            <li class="nav-item" role="presentation">
                                                <a class="nav-link {{if eq .Data.ActiveTab "reverse-ipv4"}}active{{end}}"
                                                   href="?tab=reverse-ipv4"
                                                   id="reverse-ipv4-tab"
                                                   role="tab"
                                                   aria-controls="reverse-ipv4-tab-pane"
                                                   aria-selected="{{if eq .Data.ActiveTab "reverse-ipv4"}}true{{else}}false{{end}}">
                                                    Reverse IPv4{{if .Data}} ({{.Data.ReverseV4Tab.TotalItems}}){{end}}
                                                </a>
                                            </li>
                                            <li class="nav-item" role="presentation">
                                                <a class="nav-link {{if eq .Data.ActiveTab "reverse-ipv6"}}active{{end}}"
                                                   href="?tab=reverse-ipv6"
                                                   id="reverse-ipv6-tab"
                                                   role="tab"
                                                   aria-controls="reverse-ipv6-tab-pane"
                                                   aria-selected="{{if eq .Data.ActiveTab "reverse-ipv6"}}true{{else}}false{{end}}">
                                                    Reverse IPv6{{if .Data}} ({{.Data.ReverseV6Tab.TotalItems}}){{end}}
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <!-- end::Card Header-->
                            <!-- begin::Card Body-->
                            <div class="card-body">
                                {{if .Error}}
                                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                    {{.Error}}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                                {{end}}

                                {{if .Data}}
                                {{$activeTab := .Data.ActiveTab}}
                                {{$tabData := .Data.ForwardTab}}
                                {{if eq $activeTab "reverse-ipv4"}}{{$tabData = .Data.ReverseV4Tab}}{{end}}
                                {{if eq $activeTab "reverse-ipv6"}}{{$tabData = .Data.ReverseV6Tab}}{{end}}

                                <!-- Search and Filter Form -->
                                <form method="GET" class="mb-3">
                                    <input type="hidden" name="tab" value="{{$activeTab}}">
                                    {{if $tabData.SortField}}<input type="hidden" name="sort" value="{{$tabData.SortField}}">{{end}}
                                    {{if $tabData.SortOrder}}<input type="hidden" name="order" value="{{$tabData.SortOrder}}">{{end}}
                                    <div class="row g-3">
                                        <div class="col-md-4">
                                            <label for="search" class="form-label">Search Zone Name</label>
                                            <input type="text"
                                                   class="form-control"
                                                   id="search"
                                                   name="search"
                                                   placeholder="Search by zone name..."
                                                   value="{{$tabData.SearchQuery}}">
                                        </div>
                                        <div class="col-md-3">
                                            <label for="kind" class="form-label">Zone Kind</label>
                                            <select class="form-select" id="kind" name="kind">
                                                <option value="">All Kinds</option>
                                                <option value="Native" {{if eq $tabData.FilterKind "Native"}}selected{{end}}>Native</option>
                                                <option value="Master" {{if eq $tabData.FilterKind "Master"}}selected{{end}}>Master</option>
                                                <option value="Slave" {{if eq $tabData.FilterKind "Slave"}}selected{{end}}>Slave</option>
                                            </select>
                                        </div>
                                        <div class="col-md-2">
                                            <label for="pageSize" class="form-label">Items per page</label>
                                            <select class="form-select" id="pageSize" name="pageSize">
                                                <option value="10" {{if eq $tabData.PageSize 10}}selected{{end}}>10</option>
                                                <option value="25" {{if eq $tabData.PageSize 25}}selected{{end}}>25</option>
                                                <option value="50" {{if eq $tabData.PageSize 50}}selected{{end}}>50</option>
                                                <option value="100" {{if eq $tabData.PageSize 100}}selected{{end}}>100</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3 d-flex align-items-end">
                                            <button type="submit" class="btn btn-primary me-2">Apply</button>
                                            <a href="?tab={{$activeTab}}" class="btn btn-secondary">Reset</a>
                                        </div>
                                    </div>
                                </form>

                                <!-- Zones Table -->
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover">
                                        <thead>
                                            <tr>
                                                <th style="width: 30%;">
                                                    {{$nextOrder := "asc"}}
                                                    {{if and (eq $tabData.SortField "name") (eq $tabData.SortOrder "asc")}}
                                                        {{$nextOrder = "desc"}}
                                                    {{end}}
                                                    <a href="?tab={{$activeTab}}&sort=name&order={{$nextOrder}}&page={{$tabData.CurrentPage}}&pageSize={{$tabData.PageSize}}{{if $tabData.SearchQuery}}&search={{$tabData.SearchQuery}}{{end}}{{if $tabData.FilterKind}}&kind={{$tabData.FilterKind}}{{end}}"
                                                       class="text-decoration-none text-dark d-flex align-items-center">
                                                        Zone Name
                                                        {{if eq $tabData.SortField "name"}}
                                                            {{if eq $tabData.SortOrder "asc"}}
                                                                <i class="bi bi-arrow-up ms-1"></i>
                                                            {{else}}
                                                                <i class="bi bi-arrow-down ms-1"></i>
                                                            {{end}}
                                                        {{else}}
                                                            <i class="bi bi-arrow-down-up ms-1 text-muted" style="opacity: 0.3;"></i>
                                                        {{end}}
                                                    </a>
                                                </th>
                                                <th style="width: 15%;">
                                                    {{$nextOrderKind := "asc"}}
                                                    {{if and (eq $tabData.SortField "kind") (eq $tabData.SortOrder "asc")}}
                                                        {{$nextOrderKind = "desc"}}
                                                    {{end}}
                                                    <a href="?tab={{$activeTab}}&sort=kind&order={{$nextOrderKind}}&page={{$tabData.CurrentPage}}&pageSize={{$tabData.PageSize}}{{if $tabData.SearchQuery}}&search={{$tabData.SearchQuery}}{{end}}{{if $tabData.FilterKind}}&kind={{$tabData.FilterKind}}{{end}}"
                                                       class="text-decoration-none text-dark d-flex align-items-center">
                                                        Kind
                                                        {{if eq $tabData.SortField "kind"}}
                                                            {{if eq $tabData.SortOrder "asc"}}
                                                                <i class="bi bi-arrow-up ms-1"></i>
                                                            {{else}}
                                                                <i class="bi bi-arrow-down ms-1"></i>
                                                            {{end}}
                                                        {{else}}
                                                            <i class="bi bi-arrow-down-up ms-1 text-muted" style="opacity: 0.3;"></i>
                                                        {{end}}
                                                    </a>
                                                </th>
                                                <th style="width: 15%;">
                                                    {{$nextOrderSerial := "asc"}}
                                                    {{if and (eq $tabData.SortField "serial") (eq $tabData.SortOrder "asc")}}
                                                        {{$nextOrderSerial = "desc"}}
                                                    {{end}}
                                                    <a href="?tab={{$activeTab}}&sort=serial&order={{$nextOrderSerial}}&page={{$tabData.CurrentPage}}&pageSize={{$tabData.PageSize}}{{if $tabData.SearchQuery}}&search={{$tabData.SearchQuery}}{{end}}{{if $tabData.FilterKind}}&kind={{$tabData.FilterKind}}{{end}}"
                                                       class="text-decoration-none text-dark d-flex align-items-center">
                                                        Serial
                                                        {{if eq $tabData.SortField "serial"}}
                                                            {{if eq $tabData.SortOrder "asc"}}
                                                                <i class="bi bi-arrow-up ms-1"></i>
                                                            {{else}}
                                                                <i class="bi bi-arrow-down ms-1"></i>
                                                            {{end}}
                                                        {{else}}
                                                            <i class="bi bi-arrow-down-up ms-1 text-muted" style="opacity: 0.3;"></i>
                                                        {{end}}
                                                    </a>
                                                </th>
                                                <th style="width: 15%;">Record Count</th>
                                                <th style="width: 25%;">Primary</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {{range $tabData.Zones}}
                                            <tr>
                                                <td>
                                                    <a href="/zone/{{.Name}}" class="text-decoration-none">
                                                        <code>{{.Name}}</code>
                                                    </a>
                                                </td>
                                                <td>
                                                    {{if .Kind}}
                                                    <span class="badge bg-{{if eq .Kind "Master"}}primary{{else if eq .Kind "Native"}}success{{else if eq .Kind "Slave"}}warning{{else}}secondary{{end}}">
                                                        {{.Kind}}
                                                    </span>
                                                    {{else}}
                                                    <span class="badge bg-light text-dark">Unknown</span>
                                                    {{end}}
                                                </td>
                                                <td>
                                                    {{if .Serial}}
                                                    <span class="text-muted">{{.Serial}}</span>
                                                    {{else}}
                                                    <span class="text-muted fst-italic">-</span>
                                                    {{end}}
                                                </td>
                                                <td>
                                                    <span class="badge bg-info">{{.RecordCount}}</span>
                                                </td>
                                                <td>
                                                    {{if and (eq .Kind "Slave") .Masters}}
                                                    <small class="text-muted">
                                                        {{range $index, $master := .Masters}}
                                                            {{if $index}}, {{end}}{{$master}}
                                                        {{end}}
                                                    </small>
                                                    {{else}}
                                                    <span class="text-muted fst-italic">-</span>
                                                    {{end}}
                                                </td>
                                            </tr>
                                            {{else}}
                                            <tr>
                                                <td colspan="5" class="text-center text-muted">
                                                    No zones found.
                                                    {{if or $tabData.SearchQuery $tabData.FilterKind}}
                                                    Try adjusting your search or filters.
                                                    {{end}}
                                                </td>
                                            </tr>
                                            {{end}}
                                        </tbody>
                                    </table>
                                </div>

                                <!-- Pagination -->
                                {{if gt $tabData.TotalPages 1}}
                                <nav aria-label="Zone pagination" class="mt-3">
                                    <ul class="pagination justify-content-center">
                                        <li class="page-item {{if not $tabData.HasPrevPage}}disabled{{end}}">
                                            <a class="page-link"
                                               href="?tab={{$activeTab}}&page={{$tabData.PrevPage}}&pageSize={{$tabData.PageSize}}{{if $tabData.SearchQuery}}&search={{$tabData.SearchQuery}}{{end}}{{if $tabData.FilterKind}}&kind={{$tabData.FilterKind}}{{end}}{{if $tabData.SortField}}&sort={{$tabData.SortField}}{{end}}{{if $tabData.SortOrder}}&order={{$tabData.SortOrder}}{{end}}"
                                               {{if not $tabData.HasPrevPage}}tabindex="-1" aria-disabled="true"{{end}}>
                                                Previous
                                            </a>
                                        </li>

                                        {{$currentPage := $tabData.CurrentPage}}
                                        {{$totalPages := $tabData.TotalPages}}
                                        {{$pageSize := $tabData.PageSize}}
                                        {{$searchQuery := $tabData.SearchQuery}}
                                        {{$filterKind := $tabData.FilterKind}}
                                        {{$sortField := $tabData.SortField}}
                                        {{$sortOrder := $tabData.SortOrder}}

                                        {{range $i := iterate $totalPages}}
                                        {{$pageNum := add $i 1}}
                                        {{if or (le $pageNum 3) (and (ge $pageNum (sub $currentPage 1)) (le $pageNum (add $currentPage 1))) (ge $pageNum (sub $totalPages 2))}}
                                        <li class="page-item {{if eq $pageNum $currentPage}}active{{end}}">
                                            <a class="page-link"
                                               href="?tab={{$activeTab}}&page={{$pageNum}}&pageSize={{$pageSize}}{{if $searchQuery}}&search={{$searchQuery}}{{end}}{{if $filterKind}}&kind={{$filterKind}}{{end}}{{if $sortField}}&sort={{$sortField}}{{end}}{{if $sortOrder}}&order={{$sortOrder}}{{end}}">
                                                {{$pageNum}}
                                            </a>
                                        </li>
                                        {{else if or (eq $pageNum 4) (eq $pageNum (sub $totalPages 3))}}
                                        <li class="page-item disabled"><span class="page-link">...</span></li>
                                        {{end}}
                                        {{end}}

                                        <li class="page-item {{if not $tabData.HasNextPage}}disabled{{end}}">
                                            <a class="page-link"
                                               href="?tab={{$activeTab}}&page={{$tabData.NextPage}}&pageSize={{$tabData.PageSize}}{{if $tabData.SearchQuery}}&search={{$tabData.SearchQuery}}{{end}}{{if $tabData.FilterKind}}&kind={{$tabData.FilterKind}}{{end}}{{if $tabData.SortField}}&sort={{$tabData.SortField}}{{end}}{{if $tabData.SortOrder}}&order={{$tabData.SortOrder}}{{end}}"
                                               {{if not $tabData.HasNextPage}}tabindex="-1" aria-disabled="true"{{end}}>
                                                Next
                                            </a>
                                        </li>
                                    </ul>
                                    <div class="text-center text-muted">
                                        Page {{$tabData.CurrentPage}} of {{$tabData.TotalPages}} ({{$tabData.TotalItems}} total zones)
                                    </div>
                                </nav>
                                {{end}}
                                {{else}}
                                <p class="text-center text-muted">No zone data available.</p>
                                {{end}}
                            </div>
                            <!-- end::Card Body-->
                        </div>
                        <!-- end::Card-->
                    </div>
                </div>
                <!--end::Row-->
            </div>
            <!--end::Container-->
        </div>
        <!--end::App Content-->
    </main>
    <!--end::App Main-->
    {{ template "partials/footer" .}}
</div>
<!--end::App Wrapper-->
